```{r}
options(java.parameters="-Xmx4G")
library(r5r)
library(tidyverse)
library(sf)
```

```{r}
r5 = setup_r5(file.path(Sys.getenv("DATA_PATH"), "networks", "baseline"))
```

```{r}
points = tribble(
    ~loc, ~lat, ~lon,
    "Falls of Neuse Road at Weathergreen Drive", 35.88893263462923, -78.62728248774914,
    "Wilmington St at Davie St", 35.77630917507466, -78.63820684124929
) |>
    mutate(id=1:n()) |>
    st_as_sf(coords=c("lon", "lat"), crs=4326)
```

```{r}
isos = isochrone(r5, points, mode="walk", cutoffs=c(20), max_walk_time=20)
```

```{r}
buff = points |>
    st_transform(32119) |>
    st_buffer(1200) |>
    st_transform(4326)
```

## Save for mapping

```{r}
write_sf(points, file.path(Sys.getenv("DATA_PATH"), "iso_figure", "data.gpkg"), layer="points")
write_sf(buff, file.path(Sys.getenv("DATA_PATH"), "iso_figure", "data.gpkg"), layer="buffer")
write_sf(isos, file.path(Sys.getenv("DATA_PATH"), "iso_figure", "data.gpkg"), layer="isochrones")
```